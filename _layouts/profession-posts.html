---
layout: default
---
<div class="initial-content">
  <div id="main" role="main">
    <div class="kb-archive">
      <h1 class="page__title">{{ page.title | default: "Profession Posts" }}</h1>

      {% assign professional_posts = site.posts | where: "type", "profession" %}
      
      {% assign all_tags_list = "" | split: "," %}
      {% for post in professional_posts %}
        {% if post.tags %}
          {% assign all_tags_list = all_tags_list | concat: post.tags %}
        {% endif %}
      {% endfor %}
      {% assign professional_tags = all_tags_list | uniq | sort %}

      {% assign professional_categories = "" | split: "," %}
      {% for post in professional_posts %}
        {% assign professional_categories = professional_categories | concat: post.categories | uniq %}
      {% endfor %}
      {% assign professional_categories = professional_categories | sort %}
      
      <div class="kb-tag-filter">
        <button class="kb-tag-pill active" data-tag="all">All</button>
        {% for tag in professional_tags %}
          <button class="kb-tag-pill" data-tag="{{ tag | slugify }}">{{ tag }}</button>
        {% endfor %}
      </div>

      <div class="kb-category-grid">
        {% for category in professional_categories %}
          <a href="#{{ category | slugify }}" class="kb-category-card">
            <h3 class="title">{{ category }}</h3>
            {% assign count = 0 %}
            {% for post in professional_posts %}{% if post.categories contains category %}{% assign count = count | plus: 1 %}{% endif %}{% endfor %}
            <span class="count">{{ count }} Posts</span>
          </a>
        {% endfor %}
      </div>

      {% for category in professional_categories %}
        <section id="{{ category | slugify }}" class="kb-category-section">
          <h2 class="archive__subtitle">{{ category }}</h2>
          <div class="profession-post-grid">
            {% for post in professional_posts %}
              {% if post.categories contains category %}
              {% comment %} --- Create a string of slugified tags --- {% endcomment %}
              {% capture processed_tags %}{% for tag in post.tags %}{{ tag | slugify }} {% endfor %}{% endcapture %}

              <div class="profession-post-card" data-tags="{{ processed_tags | strip }}">
                <a href="{{ post.url | relative_url }}">
                  <h4 class="title">{{ post.title }}</h4>
                  <p class="excerpt">{{ post.excerpt | strip_html | truncatewords: 20 }}</p>
                  <time class="date">{{ post.date | date: "%B %d, %Y" }}</time>
                </a>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </section>
      {% endfor %}
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterContainer = document.querySelector('.kb-tag-filter');
  const postCards = document.querySelectorAll('.profession-post-card');
  const categorySections = document.querySelectorAll('.kb-category-section');
  const categoryCards = document.querySelectorAll('.kb-category-card');

  // This function now hides cards with a count of 0
  function updateCategoryCounts() {
    categoryCards.forEach(card => {
      const targetId = card.getAttribute('href').substring(1);
      const section = document.getElementById(targetId);
      const countSpan = card.querySelector('.count');
      
      if (section && countSpan) {
        const visiblePosts = section.querySelectorAll('.profession-post-card[style*="display: block"]');
        const count = visiblePosts.length;
        
        // --- This is the new part ---
        if (count > 0) {
          // If there are posts, show the card and update the count
          card.style.display = 'block'; // Or 'flex' if you use that
          countSpan.textContent = `${count} Posts`;
        } else {
          // If there are no posts, hide the card
          card.style.display = 'none';
        }
        // --- End of new part ---
      }
    });
  }

  // 필터를 적용하는 함수 (재사용을 위해 분리)
  function applyFilter(selectedTag) {
    // 1. 버튼 활성 상태 업데이트
    const allPills = filterContainer.querySelectorAll('.kb-tag-pill');
    allPills.forEach(pill => {
      if (pill.getAttribute('data-tag') === selectedTag) {
        pill.classList.add('active');
      } else {
        pill.classList.remove('active');
      }
    });

    // 2. 포스트 카드 필터링
    postCards.forEach(card => {
      const cardTags = card.getAttribute('data-tags');
      if (selectedTag === 'all' || (cardTags && cardTags.includes(selectedTag))) {
        card.style.display = 'block';
      } else {
        card.style.display = 'none';
      }
    });

    // 3. 비어있는 카테고리 섹션 숨기기
    categorySections.forEach(section => {
      const visibleCards = section.querySelectorAll('.profession-post-card[style*="display: block"]');
      if (visibleCards.length > 0) {
        section.style.display = 'block';
      } else {
        section.style.display = 'none';
      }
    });

    // 4. 카테고리별 포스트 숫자 업데이트 함수 호출
    updateCategoryCounts();
  }

  // 페이지 로드 시 URL 파라미터를 확인하여 필터 적용
  const urlParams = new URLSearchParams(window.location.search);
  const tagFromUrl = urlParams.get('tag');
  
  if (tagFromUrl) {
    applyFilter(tagFromUrl);
  } else {
    applyFilter('all'); // 파라미터 없으면 'All' 상태로
  }

  // 태그 버튼 클릭 이벤트
  if (filterContainer) {
    filterContainer.addEventListener('click', function(e) {
      if (e.target.classList.contains('kb-tag-pill')) {
        const selectedTag = e.target.getAttribute('data-tag');
        
        applyFilter(selectedTag);

        const newUrl = selectedTag === 'all' 
          ? window.location.pathname 
          : `${window.location.pathname}?tag=${selectedTag}`;
        
        history.pushState({tag: selectedTag}, '', newUrl);
      }
    });
  }
});
</script>