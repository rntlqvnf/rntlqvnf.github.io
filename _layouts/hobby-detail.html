---
layout: default
---
{% assign hobby = site.data.pursuits[page.hobby_key] %}

<div class="hobby-detail-page">
  <header class="hobby-hero">
    <h1 class="hobby-title">{{ hobby.emoji }} {{ hobby.title }}</h1>
    <p class="hobby-excerpt">{{ hobby.excerpt }}</p>
    {% if hobby.instagram_url %}
      <a href="{{ hobby.instagram_url }}" class="insta-account-btn" target="_blank">
        <i class="fab fa-instagram"></i> View on Instagram
      </a>
    {% endif %}
  </header>

  <div class="hobby-tabs">
    {% for sub_topic in hobby.sub_topics %}
      <button class="tab-link {% if forloop.first %}active{% endif %}" data-target="{{ sub_topic.topic_id }}">{{ sub_topic.topic_title }}</button>
    {% endfor %}
  </div>

  {% for sub_topic in hobby.sub_topics %}
    <div id="{{ sub_topic.topic_id }}" class="tab-content {% if forloop.first %}active{% endif %}">
      <div class="hobby-search-wrapper">
        <i class="fas fa-search"></i>
        <input type="search" class="hobby-search-input" placeholder="Search in {{ sub_topic.topic_title }}...">
      </div>

      {% for group in sub_topic.groups %}
        <section class="hobby-sub-group">
          <h2 class="sub-group-title">{{ group.group_title }}</h2>
          <div class="content-grid">
            {% for log in group.logs %}
              {% capture search_terms %}{{ log.title }} {{ log.description }} {{ log.excerpt }} {{ log.tags | join: ' ' }}{% endcapture %}
              <div class="log-card" data-search-terms="{{ search_terms | downcase }}">
                {% if log.type == 'insta' %}
                  {% include hobby-insta-card.html url=log.url title=log.title description=log.description featured=log.featured %}
                {% elsif log.type == 'blog' %}
                  {% include hobby-blog-card.html url=log.url title=log.title excerpt=log.excerpt %}
                {% endif %}
              </div>
            {% endfor %}
          </div>
        </section>
      {% endfor %}
    </div>
  {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('.tab-link');
  const tabContents = document.querySelectorAll('.tab-content');

  // This function now reads URL Parameters instead of the hash
  function activateTabFromURL() {
    const params = new URLSearchParams(window.location.search);
    const tabId = params.get('tab'); // Looks for '?tab=...'
    if (!tabId) return;

    const targetTab = document.querySelector(`.tab-link[data-target="${tabId}"]`);
    const targetContent = document.getElementById(tabId);

    if (targetTab && targetContent) {
      // Deactivate the default first tab
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(c => c.classList.remove('active'));

      // Activate the target tab and content
      targetTab.classList.add('active');
      targetContent.classList.add('active');
    }
  }
  
  // Run the function when the page loads
  activateTabFromURL();

  // Tab Switching Logic (when a tab is clicked)
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const targetId = tab.getAttribute('data-target');
      
      // Also update the URL with the parameter when clicking
      const newUrl = window.location.pathname + `?tab=${targetId}`;
      history.pushState({}, '', newUrl);

      tabContents.forEach(content => {
        content.classList.remove('active');
        if (content.id === targetId) {
          content.classList.add('active');
        }
      });
    });
  });

  // Live Search Logic (no changes needed here)
  const searchInputs = document.querySelectorAll('.hobby-search-input');
  searchInputs.forEach(input => {
    input.addEventListener('input', e => {
      const searchTerm = e.target.value.toLowerCase();
      const parentTabContent = e.target.closest('.tab-content');
      const cards = parentTabContent.querySelectorAll('.log-card');
      const groups = parentTabContent.querySelectorAll('.hobby-sub-group');

      cards.forEach(card => {
        const searchData = card.getAttribute('data-search-terms');
        if (searchData.includes(searchTerm)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
      
      groups.forEach(group => {
        const visibleCards = group.querySelectorAll('.log-card[style*="display: block"]');
        if (visibleCards.length > 0) {
          group.style.display = 'block';
        } else {
          group.style.display = 'none';
        }
      });
    });
  });
});
</script>
